
let {
  // The default ACME provider for DNS-01 verification.
  $acme_default = {
    provider = "letsencrypt"
    challenge_type = "dns-01"
    contact = "tarkasteve@gmail.com"
    dns_provider.dnsimple = {
      key = "fhsa-9fhahsodfhajlj"
      account_id = 5432
    }
  }

}  in {

  servers = [

    // Adguard Incus container
    {
      hostname = "adguard.haltcondition.net"
      tls = {
        files = {
          keyfile = "/etc/ssl/certs/adguard.haltcondition.net.key"
          certfile = "/etc/ssl/certs/adguard.haltcondition.net.crt"
          reload = true
        }
      }
      backend = {
        url = "http://localhost:8080"
      }
    }

    // HTPC machine, hosts multiple services in contexts
    {
      hostname = "htpc.haltcondition.net"
      tls = {
        acme = $acme_default
      }
      backend = {
        url = "http://localhost:8080"
      }
    }
  ]
}
